#!/bin/bash

remote_user=calibre
remote_host=erficca.ins
remote_port=
remote_path=/home/calibre/propirata
local_path=/media/tera/backup/propirata
log_file=/media/tera/backup/propirata_archive.log
email=tommy.ael@gmail.com

### DO NOT MODIFY UNDER THIS LINE ###

date_string=`date +%F`

echo -e "#### Run of $date_string ####\n\n" > $log_file

# copy remote archive in $local_path 

echo -e " #### Rsync log ####\n\n" >> $log_file
rsync -rhv --progress $remote_user@$remote_host:$remote_port$remote_path  $local_path &>> $log_file

# generate compressed archive

echo -e " #### Tar log ####\n\n" >> $log_file
tar -cvf "$local_path"_"$date_string".tar.gz $local_path &>> $log_file


# send email

if [ -z "$email" ]; then
	echo -e "Server: "$host" \n\n Autogenerated mail\n" > /tmp/void_mail.txt
	mutt -s "[$HOST] Archive Script Finished" -a $log_file < /tmp/void_mail.txt
fi
